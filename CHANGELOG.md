## [Unreleased]
### ✨ 新增与增强 (Features & Enhancements)
- **【同步】新增远程同步连接测试**: 在“设置同步”面板中，点击“保存设置”后，脚本会自动测试与远程 Gist 的连接。如果 Gist ID 或个人访问令牌 (PAT) 无效，会立即给出“连接失败”的反馈，帮助用户快速定位和修正配置问题，提升了初次配置的体验。

### 🐛 修复 (Fixed)

- 修正了“导入设置”功能的一个严重问题。旧的逻辑会将导入的数据与本地数据合并，而不是覆盖，这可能导致在导入备份后，一些之前已删除的旧项目（如屏蔽用户、阅读进度等）重新出现。现在，导入操作会正确地用备份文件中的数据完全替换本地对应的数据。

### ⚡️ 优化 (Changed)

- 彻底重构了后台自动同步引擎。现在它不再是简单地将本地更改推送到云端，而是会执行一次完整的智能同步检查：
    - **冲突检测**：如果在后台同步时发现本地和云端数据都发生了更改，系统会自动暂停并弹窗提示用户手动解决冲突，最大限度地防止数据丢失。
    - **智能更新**：只有在必要时（例如云端有新数据或本地有新数据）才会执行拉取或推送操作。
    - **状态反馈**：针对后台同步的不同结果（如成功拉取、推送、失败或发生冲突）提供了更清晰的用户提示。
### 🎨 UI/UX 优化 (UI/UX Improvements)

- **导航栏同步按钮视觉优化**:
    - 通过为 SVG 图標添加同色描边 (`stroke`) 的方式，实现了更稳定、更清晰的视觉“加粗”效果，提升了图标在不同缩放比例下的辨识度。
    - 移除了之前版本中直接修改 SVG 源码的方式，改为纯 CSS 实现，提升了代码的可维护性。
    - 微调了按钮的内边距和对齐方式，使其在导航栏中的视觉表现更佳。

### 🎨 优化 (Style & UI)

- **设置界面动效重构**:
    - 重新实现了设置弹窗内所有可折叠区域（如“手动屏蔽的帖子列表”）的展开与收起动画。
    - 新动画采用现代 CSS Grid (`grid-template-rows`) 技术，取代了旧的 `max-height` 方法，解决了旧动画存在的布局抖动和性能问题，使交互更流畅、更稳定。
    - 折叠/展开箭头图标的实现方式从 `background-image` 更换为 `mask-image`，提升了渲染效率和对高分屏的适应性。
- **界面文本优化**:
    - 将“当前页面被关键字屏蔽的帖子”标题修改为“关键字/规则的屏蔽帖子列表”，描述更准确。

### 🎨 UI/UX 优化 (UI/UX Improvements)
- **优化远程同步 PAT 密码输入框在 Windows 下的显示效果**：修正部分 Windows 系统下字体渲染问题，提升星号 (*) 显示清晰度，并隐藏 Edge/IE 浏览器自带的显示密码图标。
- **【UI】精细调优“当前阅读位置”指示器垂直对齐**
  - 修正了指示器在不同操作系统下（尤其是Windows）图标与文本存在的细微垂直偏移问题。通过引入非对称内边距和针对性的像素微调，确保了指示器内容在视觉上的完美居中，提升了跨平台显示的一致性
### ✨ 新增与增强 (Features & Enhancements)
* **【UI/主题】删除按钮主题适配与联动**
    * 删除按钮样式重构，新增 `.s1p-delete-button` 类，支持 S1 NUX 主题与 S1 Plus 经典样式自动切换。
    * 删除按钮 hover 效果与主题色联动，SVG 图标根据主题切换色彩。
    * 设置项“跟随 S1 NUX 视觉风格”描述优化，切换时立即生效，UI 兼容性更强。
    * 导航栏自定义、关键字规则等所有删除按钮统一样式与逻辑。

### 🎨 UI/UX 优化 (UI/UX Improvements)
- 优化删除按钮的尺寸、边距与交互动画，提升整体一致性与美观度。
- 设置界面相关描述更清晰，交互体验更直观。

### 🐛 修复 (Bug Fixes)
- 修复删除按钮在 NUX 主题下 hover 样式被覆盖的问题，确保兼容所有主题模式。
- 修正 S1 NUX.css 窄滚动条颜色变量，`@thinscroll` 启用时主色由 `@sec` 改为 `@prid`，更贴合主题风格。

### 📦 其他 (Other)
- S1 NUX.css 样式表版本号更新至 2025.9.10。

### ✨ 新增与增强 (Features & Enhancements)
* **【主题兼容】新增 S1 NUX 主题兼容模式**
    * 在“设置”->“界面与个性化”中，新增“跟随 S1 NUX 主题颜色”开关，默认为开。
    * **开启时 (默认)**：脚本不再强制覆写滚动条和UI组件颜色，以完美兼容 S1 NUX 主题的外观。
    * **关闭时**：恢复 S1 Plus 经典的绿色滚动条和UI高亮颜色。

### ✨ 新增与增强 (Features & Enhancements)
* **【阅读进度】新增“当前阅读位置”浮动标识开关**
    * 在“设置”->“阅读/浏览增强”中，新增了“显示‘当前阅读位置’浮动标识”的独立开关，允许用户自由控制其显示或隐藏。
    * 此开关默认开启，且仅在“启用阅读进度跟踪”功能开启时可见并生效。

### 🎨 UI/UX 优化 (UI/UX Improvements)
* **【设置】优化设置项分组**: 调整了“通用设置”标签页内的分组标题，“功能开关”更名为“阅读/浏览增强”，“通用设置”更名为“界面与个性化”，使功能分类更直观清晰。
### ✨ 新增与增强 (Features & Enhancements)
* **【核心】阅读进度指示器体验飞跃**
    * **全新外观与动画：** “读到这里”指示器经过完全重新设计，外观更小巧精致。同时，为其增加了流畅的弹出和消失动画，视觉体验焕然一新。
    * **智能定位：** 指示器现在会悬浮在帖子标题栏的右侧，不再挤压标题内容。它会自动计算并避开“楼主”和“附件”等元素，确保完美显示。长标题也能正常滚动，不会再被遮挡。
* **性能提升**
    * 优化了帖子浏览时的滚动性能，显著降低了“阅读进度跟踪”功能在后台的资源消耗。
- **新增浏览器滚动条美化**: 现在脚本会美化浏览器滚动条的样式，使其颜色与论坛的绿色主题协调一致，提升了整体视觉统一性。
### 🎨 UI/UX 优化 (UI/UX Improvements)
- **(导航栏)** 手动同步按钮的图标已加粗，以提高可见性。
- **优化“阅读进度”指示器**:
    - 指示器文本从“读到这里”修改为“当前阅读位置”，描述更精确。
    - 微调了指示器的图标与字体大小，使其视觉上更均衡。
- **统一主题色**: 调整了脚本UI的主题色，使其与 S1 NUX 风格更加匹配。
### 🐛 修复 (Bug Fixes)
* **【核心】彻底修复帖子头部布局问题**
    * 我们重写了帖子头部的布局系统，采用更现代、更稳固的 Flexbox 技术。此项改动 **永久性地解决了** 各种情况下（如长用户名、安装多个插件图标、缩放浏览器窗口等）导致的元素错位、重叠或意外换行的问题。现在，无论何种情况，头部布局都将保持稳定和美观。
- **修复阅读进度跟踪中断问题**: 重构了 `trackReadProgressInThread` 函数，确保在帖子页面内通过“下一页”等方式动态加载新楼层后，阅读进度跟踪功能 (`IntersectionObserver`) 能够继续监视这些新增的楼层。此举解决了之前版本中，翻页后进度跟踪会失效的 Bug。
- **彻底修复帖子列表列对齐问题**:
    - 通过为列表头部动态添加一个匹配的占位单元格，而不是使用不稳定的 `colspan` 属性，从根本上解决了因脚本注入“操作”列而导致的“作者”、“回复/查看”等列表列的错位问题。
    - 增加了配套的 CSS 规则，确保在修复布局后，所有列的文本对齐方式、分隔符显示均保持与论坛原始样式一致，恢复了完美的视觉效果。
### 📦 重构 (Refactoring)

- **代码风格统一与现代化**:
    - 对整个代码库应用了 Prettier 格式化工具，统一了代码风格（如缩进、引号、间距等），提升了代码的可读性和一致性。
    - 移除和简化了大量过时的开发注释和合并指南，使代码库更整洁。
    - 将部分代码更新为更现代的 ES6+ 语法，提高了代码的简洁性。

---
## [v5.1.4] - 2025-09-07
### 🐛 修复 (Bug Fixes)

- **增强导航栏稳定性**: 改进了页面变化监测机制 (`MutationObserver`)，使其能够自动检测并修复论坛原生脚本导致的导航栏重置问题。此举确保了“S1 Plus 设置”和“手动同步”等按钮在页面加载和动态更新过程中始终可见，解决了它们可能意外消失的 Bug。

---
## [v5.1.3] - 2025-09-07
### 🚀 功能增强 (Enhancements)

- **新增手动同步高级模式**:
  - 在设置中增加 “启用手动同步高级模式” 选项。
  - **默认模式 (关闭)**: 点击导航栏的同步按钮，将根据本地与云端的时间戳智能判断是“推送”还是“拉取”。
  - **高级模式 (开启)**: 鼠标悬停在同步按钮上时，会浮现一个快捷菜单，允许用户明确选择执行 **强制推送 (Push)** 或 **强制拉取 (Pull)** 操作，给予用户完全的数据流向控制权。
- **重构并优化了行内菜单**:
  - 引入了更通用的 `createInlineActionMenu` 组件，用于创建悬浮菜单，提升了代码的复用性和可扩展性。
  - 为新的高级同步菜单设计了独立的图标和样式，使其与现有 UI 风格保持一致。

---
## [v5.1.2] - 2025-09-07
### ✨ 新增与增强 (Features & Enhancements)
- 优化了多标签页启动时的同步逻辑：通过引入“同步锁”机制，确保了当每日首次访问、同时打开多个论坛标签页时，只有一个标签页会执行同步任务。这避免了潜在的重复操作、不确定的同步结果和页面刷新问题，使启动体验更流畅、更可靠。
- 改进了同步冲突的处理方式：当检测到数据冲突时，不再使用短暂的右下角提示。取而代之的是一个清晰的、阻塞式的对话框，它会主动引导用户选择“立即解决”或“稍后处理”。这使得冲突状态不会被忽略，极大地提升了数据安全性与用户体验。

### 🎨 UI/UX 优化 (UI/UX Improvements)

### 🐛 修复 (Bug Fixes)
- 修复了一个严重的远程数据覆盖问题：修复了一个在特定条件下（通常为重装脚本或清除浏览器缓存后），“每日首次加载自动同步”功能会错误地使用本地默认配置覆盖云端备份的致命Bug。现在，脚本能够正确识别并拉取云端数据来恢复您的配置，而不是错误地推送本地空配置。

### 📦 重构 (Refactoring)

---
## [v5.1.1] - 2025-09-07

### 🎨 UI/UX 优化 (UI/UX Improvements)

### 🐛 修复 (Bug Fixes)
- 修复了远程同步功能因缺少对 api.github.com 的连接授权，导致被油猴脚本管理器（Tampermonkey）安全策略拦截而无法使用的问题。现在，正确配置了 Gist ID 和 PAT 的用户可以正常使用手动及自动同步功能。

### 📦 重构 (Refactoring)


---
## [v5.1.0] - 2025-09-07
### ✨ 新增与增强 (Features & Enhancements)
- **新增“每日首次加载时同步”功能**：在“设置同步”中增加了一个新的独立开关。启用后，脚本会在每天第一次打开论坛时自动执行一次同步。这对于在不同设备间交替使用的用户非常有用，可以确保总是在最新的数据基础上开始浏览。
- **启动时智能同步与刷新**：重构了脚本启动时的同步逻辑。现在，如果启动时（无论是每日首次同步还是常规的自动同步）从云端拉取了新数据，脚本会显示提示并自动刷新页面。这可以避免在旧数据上进行操作，从根本上保证了数据的一致性。
- **远程同步状态反馈**：导航栏的手动同步按钮现在会通过不同的颜色和动画实时显示同步状态，包括“同步中”、“同步成功”和“同步失败”，让操作结果一目了然。
- **智能同步冲突处理**：当检测到本地与云端数据不一致或存在版本冲突时，脚本会弹出清晰的对话框，展示两边数据的时间戳，并让您自主选择保留哪个版本（推送或拉取），避免数据意外丢失。
- **云端数据损坏保护**：当检测到您的云端备份文件已损坏或校验失败时，脚本会自动暂停同步以保护您当前健康的本地数据，并提供使用本地数据修复云端备份的选项。
- **首次同步引导**：在您首次配置并使用远程同步功能时，脚本会检测到云端备份为空，并引导您将当前的本地设置作为初始版本推送到云端。

### 🎨 UI/UX 优化 (UI/UX Improvements)
- **优化手动同步按钮交互**：极大地增强了导航栏手动同步按钮的视觉反馈。
  - 动画过程中按钮将被锁定，防止重复点击。
- **优化同步按钮视觉表现**：
  - 替换了导航栏手动同步按钮的 SVG 图标，使其更清晰。
  - 调整了图标的大小和垂直位置，以实现与导航栏文本更好的视觉对齐。
  - 简化了同步状态的动画效果，仅保留“同步中”的旋转动画，移除了成功和失败状态的视觉特效，使反馈更简洁。
- 优化了“设置同步”面板的交互逻辑，当远程同步总开关关闭时，下方的所有相关设置项（如 Gist ID、Token 输入框、按钮等）都会被清晰地置为禁用状态。
- 微调了导航栏中手动同步按钮的位置，使其排列更加协调。
- [样式改进] 调整了悬浮提示框（Toast）的默认样式，使其视觉上与脚本的整体主题（如设置面板）更加统一。

### 🐛 修复 (Bug Fixes)

### 📦 重构 (Refactoring)
- **重构 `performAutoSync` 函数**：核心同步函数现在会返回一个详细的状态对象，使其行为（如“已推送”、“已拉取”、“无变化”、“冲突”等）对调用者完全透明，增强了系统的健壮性。
- **重构主流程 `main` 函数**：`main` 函数现在是异步的，并且会等待启动同步流程 `handleStartupSync` 完成。如果检测到页面需要刷新，它会中断后续所有脚本的初始化，避免了不必要的资源消耗。
- 对核心的 `handleManualSync` 函数进行了彻底重构，实现了业务逻辑与 UI 表现的完全解耦，大幅提升了代码的可维护性和功能的稳定性。

---
## [v5.0.0] - 2025-09-02
### ✨ 新增与增强 (Features & Enhancements)
-   **全新回复收藏功能**：
    -   现在可以收藏帖子内的任意楼层回复，方便日后回顾。
    -   在设置面板中新增了独立的“回复收藏”管理标签页，提供强大的搜索功能（支持内容、作者、帖子标题）和关键词高亮。
    -   支持在管理面板中快速跳转到原始帖子楼层。
    -   收藏数据已完全整合到远程同步功能中。
-   **远程同步功能全面升级 (安全与稳定)**：
    -   **数据完整性校验**：引入 SHA-256 哈希校验机制，在同步前会自动验证云端备份的完整性，从根本上杜绝了因备份损坏导致本地数据被覆盖的风险。
    -   **智能冲突处理**：当手动同步检测到云端与本地数据不一致时，会弹出更智能、更清晰的选择界面，明确展示两端数据的最后更新时间，引导用户选择合并方式。
    -   **损坏备份修复**：当检测到云端备份文件已损坏时，会主动暂停同步以保护本地数据，并引导用户通过强制推送本地健康的备份来修复云端数据。
    -   **向后兼容**：新版同步功能可自动识别并迁移旧版（v3.2）的备份数据结构，实现无缝升级。
-   **阅读进度自动清理** M:
    -   新增阅读记录自动清理功能，用户可在“通用设置”中配置清理周期（1个月、3个月、6个月或永不），以自动删除陈旧的阅读记录，保持数据整洁。

### 🎨 UI/UX 优化 (UI/UX Improvements)
-   **全新帖子操作菜单**：
    -   彻底重构了帖子列表页的屏蔽操作，使用更紧凑、更现代的三点式操作菜单替代了原有的悬浮按钮，界面更整洁，操作体验更佳。
-   **现代化通知系统**：
    -   使用全新的“Toast”通知替代了过去简单的文本提示，动画效果更平滑，且不会打断用户在设置面板中的操作。错误提示增加了抖动动画，更醒目。
-   **行内快捷确认**：
    -   在帖子楼层中操作“屏蔽用户”或“删除用户标记”时，使用更快捷的行内确认菜单替代了过去会中断操作流程的弹窗，交互更流畅。
-   **设置面板交互升级**：
    -   **动态宽度调整**：设置面板的宽度现在可以根据标签页数量自动调整，防止在高分辨率下标签栏换行。
    -   **新增分段控件**：引入了更美观、更直观的滑块式分段控件，用于“阅读进度清理”等设置项。
    -   **列表操作优化**：在“用户屏蔽”和“用户标记”列表中删除条目时，将平滑地移除该项，而不是刷新整个列表，体验更流畅。
    -   **远程同步界面优化**：优化了手动同步冲突选择弹窗的 UI、时间戳显示样式以及教程提示区样式，提升了视觉效果和信息辨识度。

### 🐛 修复 (Bug Fixes)
-   **核心布局修复**：
    -   **[重大修复]** 采用全新的 Flexbox 布局重写了帖子楼层作者信息栏（`.pi`）的样式，彻底解决了因论坛自身样式缺陷导致的“电梯直达”、“楼主”等元素被遮挡、无法点击或布局错乱的顽固 BUG。
-   **兼容性修复**：
    -   **置顶帖**：修复了阅读进度跟踪、关键字屏蔽、用户联动屏蔽等多项核心功能对置顶帖不生效的严重问题。
    -   **S1 NUX 主题**：重构了样式检测逻辑，解决了脚本部分功能与 S1 NUX 主题样式冲突的问题。
-   **远程同步修复**：
    -   修复了导入数据会覆盖本地 Gist ID 和个人访问令牌（PAT）的严重问题。
    -   修复了导入数据后，本地时间戳未同步更新导致版本判断不一致的问题。
-   **阅读进度修复**：
    -   增强了帖子 ID 和页码的获取逻辑，使其在搜索结果页等非标准帖子URL下也能稳定跟踪阅读进度。
-   **交互修复**：
    -   修复了帖子列表中的页码链接不遵循“在新窗口打开”设置的问题。

### 📦 重构 (Refactoring)
-   **数据结构升级 (v4.0)**：
    -   为所有导出和远程同步的数据设计了全新的 `v4.0` 结构。新结构将所有核心数据封装在 `data` 字段下，并增加了 `version`、`lastUpdated` 和 `contentHash` 字段，为数据校验和未来迁移提供了坚实基础。
-   **同步逻辑重构**：
    -   完全重构了远程同步的底层逻辑，使其完全异步化，并深度整合了哈希校验、版本迁移、冲突判断等机制，代码更清晰，运行更稳定。
-   **CSS 架构重构**：
    -   对脚本的 CSS 进行了大规模重构，全面应用 CSS 变量，统一了颜色、间距和组件样式，提高了代码的可维护性和主题扩展性。
-   **DOM 操作优化**：
    -   重构了帖子楼层内操作按钮的渲染逻辑，改为更精准、更高效的单点更新模式（`refreshSinglePostActions`），避免了在用户标记、屏蔽后对整个页面的所有帖子进行不必要重绘，提升了性能。

---

## [v4.4.3] - 2025-08-16
### ✨ 新增与增强
- **阅读进度**: 新增“在新窗口打开阅读进度”的设置项，允许用户自由选择点击阅读进度按钮是在新窗口还是当前窗口打开页面，默认为新窗口。

### 🎨 优化与重构
- **阅读进度**: 重构了阅读进度跟踪机制，改为在用户停止滚动后自动保存，并增加了进度回滚保护，显著提升了进度记录的准确性和稳定性，解决了快速跳转或向上滚动时进度丢失或回退的问题。

---

## [v4.4.2] - 2025-08-15
### 修复
- **核心**: 修复了 `visibilitychange` 事件监听器可能被重复添加的问题，提高了脚本的稳定性和性能。

---

## [v4.4.1] - 2025-08-14
### 修复
- **阅读进度跟踪**: 改进了阅读进度跟踪功能，修复了在非帖子列表页面（如导读页）可能出现的脚本错误。

### 优化
- **阅读进度跟踪**: 优化了获取帖子 ID 和页码的逻辑，使其更加稳定可靠。

---

## [v4.4.0] - 2025-08-13
### 修复

- **恢复阅读进度跟踪**: 恢复了在帖子内部跟踪阅读进度的功能，该功能在之前的版本中被意外移除。

---

## [v4.3.0] - 2025-08-13
### ✨ 新增与增强
- **全新用户标记系统**:
    - 可为任意用户添加、编辑或删除自定义文本标记。
    - **统一操作入口**: 将“用户屏蔽”和“用户标记”功能统一整合到帖子楼层顶部的操作栏中，取代了过去悬停在头像上的旧版交互，操作路径更清晰。
    - 为已标记用户提供独立的“编辑/删除”菜单。
    - 在设置中心新增“用户标记”管理面板，可集中管理所有标记，并支持数据导入/导出。
    - 当用户标记过长时，鼠标悬停可显示完整内容的浮窗。
- **新增图片隐藏功能**:
    - 在“通用设置”中增加“默认隐藏帖子图片”的全局开关。
    - 开启后，帖子内的图片将被占位符替代，可点击占位符单独显示图片。
    - 在每层楼内增加“显示/隐藏本楼所有图片”的快捷按钮，方便批量操作。
- **精细化数据清除**: 在“设置同步”中，用更安全的按模块清除数据的工具，替代了过去“一键重置”的危险操作。
- **自动签到**: 增加了 `GM_xmlhttpRequest` 支持，并优化了签到逻辑，使其更稳定可靠。

### 🎨 UI/UX 优化
- **帖子屏蔽交互升级**:
    - **新增二次确认**: 点击“屏蔽”按钮后，需要再次点击“确认”图标方可屏蔽，有效防止误操作。
    - **全新动画效果**: 重做了屏蔽按钮的交互，通过平移动画为按钮腾出空间，视觉效果更平滑。
    - **按钮重新设计**: 将确认/取消操作升级为更现代化的 SVG 图标按钮。
- **阅读进度显示优化**:
    - **精确显示新回复**: 通过记录楼层号，可精确计算并显示 `+N` 条新回复。
    - **优化信息展示**: 跳转按钮会显示为 `P<页码>-#<楼层号>`，并增加了图标，信息更直观。
- **设置面板重构**:
    - **布局调整**: 将原“界面定制”拆分为“导航栏定制”和“通用设置”，功能划分更清晰。
    - **交互优化**: 为各功能模块增加了独立的启用开关，并配合更平滑的展开/折叠动画。
- **文本优化**: 将帖子楼层中的“只看该作者”统一修改为“只看该用户”，描述更准确。
- **移除头像悬浮层**: 移除了旧版在用户头像上的悬停屏蔽按钮和标记弹窗，解决了因头像加载延迟导致的按钮错位、闪烁或不显示的问题。

### 🐛 修复
- **核心布局修复**: 修复了论坛帖子作者信息栏 `.pi` 的高度塌陷问题，解决了其背景可能遮挡“电梯直达”、“楼主”等链接导致无法点击的 BUG。
- **功能兼容性**: 修复了脚本操作按钮与论坛原生的“只看该作者”、“回复”等按钮的布局冲突和样式问题。

### 📦 技术与重构
- **数据结构升级**: 升级了用户标记、阅读进度等功能的数据结构，并内置了从旧版本自动迁移数据的逻辑。
- **代码重构**: 对核心的 DOM 变动监测逻辑 (`MutationObserver`) 进行了重构，改为更高效、更稳定的 `applyChanges` 流程。

---

## [v4.2.0] - 2025-08-09

### ✨ 新增与增强

- **自定义页面标题**: 在“界面定制”设置中，新增了修改页面标题后缀的功能，方便用户个性化浏览器标签页的显示。
- **随机图更换**: 点击漫区顶部的随机图，可以立即更换一张新的图片。

### 🎨 UI/UX 优化

- **“继续阅读”按钮优化**: 将帖子列表中的“回到第X页”的阅读进度跳转按钮移至页码栏之后，并调整了样式，使其更醒目且不干扰标题浏览。
- **帖子屏蔽按钮交互改进**: 帖子屏蔽按钮仅在鼠标悬停于帖子最左侧时出现，减少了对视线的干扰。
- **UI 风格统一**:
    - **颜色体系**: 全面应用了新的全局颜色变量，使脚本的所有 UI 元素（按钮、弹窗、设置面板等）在颜色上与 S1 论坛的默认主题更贴合、更统一。
    - **组件前缀统一**: 将所有 CSS 类名和 ID 的前缀统一为 `s1p-`，规范了代码并避免了潜在的样式冲突。
- **设置面板重新设计**: 对设置面板的整体 UI 进行了重新设计，包括标签页、按钮、输入框、列表项等，使其布局更清晰，视觉效果更佳。
- **用户标记悬浮窗重新设计**: 重新设计了用户标记的悬浮窗，优化了布局和样式，使其更美观易用。

### 📦 构建与重构

- **发布流程**: 添加了标准化的发布命令，简化了版本发布流程。
- **CSS 重构**: 使用 CSS 全局变量重构了样式代码，提高了可维护性和主题扩展性。
- **代码重构**: 优化了屏蔽用户引用和评分的处理逻辑。

---

## [v4.1.0] - 2025-08-05

### ✨ 功能增强

- **优化引用屏蔽样式与动画**:
    - **样式优化**: 将被屏蔽引用的占位符从灰色背景盒子改为更简洁的文本样式，并将“展开/折叠”按钮更新为与设置面板统一的圆角矩形按钮。
    - **增加动画**: 为引用的展开和折叠过程增加了平滑的 `max-height` 过渡动画，提升了视觉效果和用户体验。
    - **动画修复**: 解决了动画过程中因高度计算不精确导致的显示不完整和布局偏移问题，确保动画的流畅和稳定。
- **优化引用屏蔽体验**:
    - **即时生效**: 修复了屏蔽用户后，其引用不会立即隐藏，需要手动刷新页面的问题。
    - **占位符替换**: 被屏蔽用户的引用不再是直接消失，而是被一个更友好的占位符替换，提示“一条来自已屏蔽用户的引用已被隐藏。”。
    - **临时查看**: 占位符提供“点击展开/折叠”功能，允许临时查看被屏蔽的引用内容。
    - **样式优化**: 优化了占位符及其按钮的样式，使其在视觉上更贴合论坛和脚本的整体风格，并调整了边距以避免占满整个内容宽度。

---

## [v4.0.2] - 2025-08-05

### 🐛 问题修复
- **修复评分帖子隐藏错误**: 解决了屏蔽用户后，可能会错误地将该用户评分过的帖子整体隐藏的问题。新的实现能更精确地定位并只隐藏发帖者为被屏蔽用户的帖子。
- **修复评分状态刷新**: 修复了取消屏蔽用户后，其评分记录不会立刻重新显示的问题。现在，无论是屏蔽还是取消屏蔽，相关评分的可见性都会即时更新。

### 🐛 问题修复
- **修复用户屏蔽按钮显示异常**: 重构了在用户头像上添加屏蔽按钮的逻辑，通过等待图片完全加载后才计算按钮位置和大小，彻底解决了因网络延迟或图片缓存问题导致的悬浮按钮错位、尺寸不正确或不显示的 BUG。

### ⚡️ 性能优化
- **优化页面变化监测性能**: 将 `MutationObserver` 的监听范围从整个页面 (`body`) 精准地缩小到内容区域 (`#ct`)，显著减少了不必要的脚本重复运行，降低了性能开销，提升了页面流畅度。

---

## [v4.0.0] - 2025-08-02
### 维护

-   **清理项目文件:** 删除了一个不再需要的截图文件 (`longshot20250802025336.png`)，以保持项目仓库的整洁。

### 优化

-   **用户标记浮窗 (User Tagging Popover):**
    -   **UI/UX 大修:** 完全重新设计了用户标记浮窗，使其具有更现代化、更美观的界面。
        -   **页脚信息:** 浮窗现在会显示用户的头像、用户名和 UID，信息更一目了然。
        -   **动态布局:** 浮窗宽度会根据内容（如用户名长度）动态调整，防止文本溢出。
        -   **统一按钮风格:** 更新了浮窗内的所有按钮（添加、编辑、删除、保存、取消），使其默认显示为灰色，并在鼠标悬停时分别变为蓝色（常规操作）或红色（删除操作），与脚本的整体风格保持一致。
    -   **功能改进:**
        -   **输入法兼容性:** 修复了在使用输入法（IME）输入时，浮窗会意外关闭的问题。

### 🎨 优化与重构

*   **UI 微调与版本更新**：
    *   优化了用户标签浮窗中操作按钮的 padding、字体大小和圆角，使其视觉上更精致、协调。
    *   将设置面板内列表项的背景色恢复为淡灰色 (`#f9fafb`)，以修正之前版本中过于刺眼的纯白背景，确保了整体 UI 风格的统一性和舒适度。
    *   更新脚本版本号至 `3.2.2`。

### 🎨 优化与重构

*   **优化用户标签浮窗样式 (v4)**：
    *   **全新视觉设计**：重新设计了用户标签浮窗，采用现代化的半透明玻璃效果 (backdrop-filter)，并优化了边框、阴影和配色，使其更具质感和美观度。
    *   **增强交互体验**：为浮窗内的按钮（如编辑、删除）添加了清晰的 SVG 图标，提升了可识别性。同时，改善了按钮的交互动画和高亮效果，使操作反馈更直观。
    -   **改善布局与内容**：调整了浮窗内部的布局、间距和字体样式，提升了信息的可读性。在没有标签时，会显示更友好的提示信息。

### 🎨 优化与重构

*   **优化悬浮窗交互**：通过增加延迟显示和优化隐藏逻辑，改善了鼠标在用户头像上快速划过时的体验，避免了不必要的浮窗闪烁，使其交互更加稳定和流畅。

### ✨ 新增与增强

*   **初步增加用户标记功能**：当鼠标悬停在用户头像上时，会显示一个悬浮窗，为后续的标记、编辑和删除功能打下基础。

### 🎨 优化与重构

*   **重构悬浮窗交互**：采用事件委托和智能延迟机制重写了悬浮窗的显示/隐藏逻辑，彻底解决了因鼠标快速移动导致的闪烁和异常消失问题，交互体验更稳定、流畅。
*   **优化悬浮窗UI**：重新设计了用户标记浮窗的UI，使其在视觉风格上与脚本整体保持和谐统一，并提升了布局的清晰度和美观度。

### 🐛 问题修复

*   **修复UI遮挡问题**：通过将悬浮窗挂载到 `body` 而非表格单元格，从根本上解决了其被帖子内容区域遮挡的问题。
*   **修复功能冲突**：清除了所有导致新旧功能冲突的CSS和JS代码，确保了“屏蔽用户”等原有功能的UI和交互恢复正常。

### 🎨 优化与重构

*   **优化设置项交互**:
    *   将设置面板中的所有复选框（Checkbox）替换为更现代、更直观的拨动开关（Toggle Switch），提升了视觉效果和操作体验。
    *   改进了“标题关键字屏蔽”功能的工作流，将自动实时保存改为手动点击“保存规则”按钮确认，避免了误操作和不必要的性能开销，并增加了操作成功提示。

### 🎨 优化与重构

* **统一UI颜色**: 脚本中所有功能性红色（如删除、恢复默认、错误提示等）统一为 `#ef4444`，以增强视觉一致性。
* **优化导航栏编辑器**:
    * 修复了拖拽排序时条目变灰且排序不稳定的问题，提升了拖拽体验。
    - 移除了保存设置时的成功提示，使交互流程更简洁。
* **更新图标**: 将编辑器中的“删除”操作从文字图标 '✖' 升级为更现代、更直观的SVG垃圾桶图标，并优化了其高亮交互效果。

### ✨ 新增与增强

* **新增标题关键字屏蔽**: 新增通过关键字或正则表达式屏蔽帖子的功能，并包含独立的规则编辑器。
* **新增用户评分屏蔽**: 现在屏蔽一个用户后，其在帖子下的所有评分记录（战斗力、理由等）也会被自动隐藏。

### 🎨 优化与重构

* **重构关键字屏蔽编辑器**:
    * 移除了“保存规则”按钮，改为自动实时保存机制，并为输入框增加了400ms防抖以优化性能。
    * 优化了工作流：新增的规则默认不启用，并去除了频繁的保存提示。
* **设置面板UI重构**:
    - 将“帖子屏蔽”页的列表重构为可平滑折叠的区域，优化了空间利用。
    - 增强了“界面定制”中的导航链接编辑器，提供了更清晰的布局和拖拽手柄。
    - 将设置面板的关闭按钮替换为更现代的SVG图标。
* **核心与数据**:
    - “设置同步”功能现已完全支持新的关键字屏蔽规则。
    - 实现了对旧版本关键字数据的自动迁移，确保无缝升级。

### 🐛 问题修复

* 修复了从搜索结果页等特定链接 (`mod=viewthread`) 进入帖子后，用户屏蔽功能不生效的问题。
* 修复了关键字编辑器在旧版手动保存逻辑下，会导致UI组件无响应和输入框重复出现的严重BUG。

---

## [v3.0.1] - 2025-07-28

### 🐛 问题修复

*   修复了从搜索结果页打开帖子时，用户屏蔽功能不生效的问题。

---

## [v3.0] - 2025-07-27

### ✨ 新增与增强

*   **新增“跳转至上次阅读位置”功能 (v3.0)**：
    *   **自动记录进度**：在浏览帖子时，脚本会自动在后台记录您看到的最后一个回复的位置。
    *   **快速跳转链接**：在帖子列表页面，对于有阅读记录的帖子，标题旁边会显示一个 `[跳转]` 链接，点击即可直接跳到上次中断的地方，无缝衔接您的阅读体验。
*   **联动屏蔽功能 (v2.8)**：现在当您屏蔽一个用户时，可以选择同时屏蔽该用户发布的所有主题帖。
*   **全量设置同步 (v2.8)**：同步功能得到全面增强，可以一键导出/导入所有配置，包括屏蔽列表、导航栏和各项开关的状态。

### 🎨 优化与重构

*   **设置面板重构 (v2.8)**：设置面板重构为四个独立的标签页，功能划分更清晰。
*   **代码结构优化**：对多个功能模块进行了代码优化和重构，提升了脚本的稳定性和可维护性。

---

## [v2.7] - 2025-07-26

### 🐛 问题修复

* 修复了自动签到功能在多账号切换时状态不互通的问题。

---

## [v2.6] - 2025-07-26

### 🐛 问题修复

* 修复了自动签到功能被移除的问题。

---

## [v2.5] - 2025-07-26

### 🎨 优化与重构

* **帖子屏蔽按钮UI**：重做并升级了帖子屏蔽按钮的UI和交互，采用更现代化的悬浮标签样式，并增加了更平滑的动画效果，提升了操作直观性和视觉体验。

---

## [v2.4] - 2025-07-26

### ✨ 新增与增强

* **新增“界面定制”功能**：
    * **自定义导航栏**：允许通过拖拽方式自由管理导航链接。
    * **调整界面元素**：可修改论坛Logo链接及隐藏屏蔽用户发言的提示条。

### 🎨 优化与重构

* **设置管理**：重构了设置的保存与加载逻辑，使所有界面定制选项均可即时生效。
* **代码结构**：对UI创建和事件处理部分的代码进行了模块化重构。

---

## [v2.3] - 2025-07-26

### 🐛 问题修复

* **样式兼容性**：调整了屏蔽按钮的CSS，解决了与自定义主题（如 “S1 NUX”）的样式冲突问题。

---

## [v2.2] - 2025-07-26

### 🎨 优化与重构

* **确认弹窗**：重写了屏蔽用户的确认弹窗，替换系统默认弹窗，统一了UI风格并增加了动画效果，提升了用户体验。

---

## [v2.1] - 2025-07-26

### ✨ 新增与增强

* 在“屏蔽管理”面板的页脚增加了版本号和发布日期显示。

### 🎨 优化与重构

* 移除了脚本文件内嵌的更新日志等注释，使代码更简洁。

---

## [v2.0] - 2025-07-26

### ✨ 新增与增强

* **新增用户屏蔽核心功能**：支持鼠标悬停于用户头像上进行屏蔽。

### 🎨 优化与重构

* **屏蔽管理界面**：重新设计管理弹窗，使用选项卡区分“帖子屏蔽”与“用户屏蔽”。
* **数据同步**：更新了导入/导出功能，使其能同时处理帖子和用户的屏蔽数据。
* **UI/UX**：改进了屏蔽按钮的交互动画和视觉样式。

---

## [v1.0 - v1.9]

* **v1.9**：修复了自动签到功能在多账号切换时状态不互通的问题。
* **v1.8**：新增自动签到功能；并修复了部分情况下帖子列表第一个帖子不显示屏蔽按钮的bug。
* **v1.7**：整合了 `@match` 指令，提高匹配效率。
* **v1.6**：新增设置项允许用户选择屏蔽按钮显示位置；并优化了设置项体验，关闭窗口后自动刷新页面。
* **v1.5**：修复了帖子详情页面不显示“屏蔽管理”按钮的bug。
* **v1.4**：优化了屏蔽按钮样式，增加字体粗细。
* **v1.3**：增加了屏蔽按钮右侧间距，解决与“New”标签重叠问题。
* **v1.2**：添加了置顶帖屏蔽功能。
* **v1.1**：添加了多设备同步功能并优化了UI。
* **v1.0**：初始版本发布，实现了基本的帖子屏蔽功能和管理界面。