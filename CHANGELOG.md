## [Unreleased]
### ✨ 新增与增强
- **阅读进度**: 新增“在新窗口打开阅读进度”的设置项，允许用户自由选择点击阅读进度按钮是在新窗口还是当前窗口打开页面，默认为新窗口。

### 🎨 优化与重构
- **阅读进度**: 重构了阅读进度跟踪机制，改为在用户停止滚动后自动保存，并增加了进度回滚保护，显著提升了进度记录的准确性和稳定性，解决了快速跳转或向上滚动时进度丢失或回退的问题。

---

## [v4.4.2] - 2025-08-15
### 修复
- **核心**: 修复了 `visibilitychange` 事件监听器可能被重复添加的问题，提高了脚本的稳定性和性能。

---

## [v4.4.1] - 2025-08-14
### 修复
- **阅读进度跟踪**: 改进了阅读进度跟踪功能，修复了在非帖子列表页面（如导读页）可能出现的脚本错误。

### 优化
- **阅读进度跟踪**: 优化了获取帖子 ID 和页码的逻辑，使其更加稳定可靠。

---

## [v4.4.0] - 2025-08-13
### 修复

- **恢复阅读进度跟踪**: 恢复了在帖子内部跟踪阅读进度的功能，该功能在之前的版本中被意外移除。

---

## [v4.3.0] - 2025-08-13
### ✨ 新增与增强
- **全新用户标记系统**:
    - 可为任意用户添加、编辑或删除自定义文本标记。
    - **统一操作入口**: 将“用户屏蔽”和“用户标记”功能统一整合到帖子楼层顶部的操作栏中，取代了过去悬停在头像上的旧版交互，操作路径更清晰。
    - 为已标记用户提供独立的“编辑/删除”菜单。
    - 在设置中心新增“用户标记”管理面板，可集中管理所有标记，并支持数据导入/导出。
    - 当用户标记过长时，鼠标悬停可显示完整内容的浮窗。
- **新增图片隐藏功能**:
    - 在“通用设置”中增加“默认隐藏帖子图片”的全局开关。
    - 开启后，帖子内的图片将被占位符替代，可点击占位符单独显示图片。
    - 在每层楼内增加“显示/隐藏本楼所有图片”的快捷按钮，方便批量操作。
- **精细化数据清除**: 在“设置同步”中，用更安全的按模块清除数据的工具，替代了过去“一键重置”的危险操作。
- **自动签到**: 增加了 `GM_xmlhttpRequest` 支持，并优化了签到逻辑，使其更稳定可靠。

### 🎨 UI/UX 优化
- **帖子屏蔽交互升级**:
    - **新增二次确认**: 点击“屏蔽”按钮后，需要再次点击“确认”图标方可屏蔽，有效防止误操作。
    - **全新动画效果**: 重做了屏蔽按钮的交互，通过平移动画为按钮腾出空间，视觉效果更平滑。
    - **按钮重新设计**: 将确认/取消操作升级为更现代化的 SVG 图标按钮。
- **阅读进度显示优化**:
    - **精确显示新回复**: 通过记录楼层号，可精确计算并显示 `+N` 条新回复。
    - **优化信息展示**: 跳转按钮会显示为 `P<页码>-#<楼层号>`，并增加了图标，信息更直观。
- **设置面板重构**:
    - **布局调整**: 将原“界面定制”拆分为“导航栏定制”和“通用设置”，功能划分更清晰。
    - **交互优化**: 为各功能模块增加了独立的启用开关，并配合更平滑的展开/折叠动画。
- **文本优化**: 将帖子楼层中的“只看该作者”统一修改为“只看该用户”，描述更准确。
- **移除头像悬浮层**: 移除了旧版在用户头像上的悬停屏蔽按钮和标记弹窗，解决了因头像加载延迟导致的按钮错位、闪烁或不显示的问题。

### 🐛 修复
- **核心布局修复**: 修复了论坛帖子作者信息栏 `.pi` 的高度塌陷问题，解决了其背景可能遮挡“电梯直达”、“楼主”等链接导致无法点击的 BUG。
- **功能兼容性**: 修复了脚本操作按钮与论坛原生的“只看该作者”、“回复”等按钮的布局冲突和样式问题。

### 📦 技术与重构
- **数据结构升级**: 升级了用户标记、阅读进度等功能的数据结构，并内置了从旧版本自动迁移数据的逻辑。
- **代码重构**: 对核心的 DOM 变动监测逻辑 (`MutationObserver`) 进行了重构，改为更高效、更稳定的 `applyChanges` 流程。

---

## [v4.2.0] - 2025-08-09

### ✨ 新增与增强

- **自定义页面标题**: 在“界面定制”设置中，新增了修改页面标题后缀的功能，方便用户个性化浏览器标签页的显示。
- **随机图更换**: 点击漫区顶部的随机图，可以立即更换一张新的图片。

### 🎨 UI/UX 优化

- **“继续阅读”按钮优化**: 将帖子列表中的“回到第X页”的阅读进度跳转按钮移至页码栏之后，并调整了样式，使其更醒目且不干扰标题浏览。
- **帖子屏蔽按钮交互改进**: 帖子屏蔽按钮仅在鼠标悬停于帖子最左侧时出现，减少了对视线的干扰。
- **UI 风格统一**:
    - **颜色体系**: 全面应用了新的全局颜色变量，使脚本的所有 UI 元素（按钮、弹窗、设置面板等）在颜色上与 S1 论坛的默认主题更贴合、更统一。
    - **组件前缀统一**: 将所有 CSS 类名和 ID 的前缀统一为 `s1p-`，规范了代码并避免了潜在的样式冲突。
- **设置面板重新设计**: 对设置面板的整体 UI 进行了重新设计，包括标签页、按钮、输入框、列表项等，使其布局更清晰，视觉效果更佳。
- **用户标记悬浮窗重新设计**: 重新设计了用户标记的悬浮窗，优化了布局和样式，使其更美观易用。

### 📦 构建与重构

- **发布流程**: 添加了标准化的发布命令，简化了版本发布流程。
- **CSS 重构**: 使用 CSS 全局变量重构了样式代码，提高了可维护性和主题扩展性。
- **代码重构**: 优化了屏蔽用户引用和评分的处理逻辑。

---

## [v4.1.0] - 2025-08-05

### ✨ 功能增强

- **优化引用屏蔽样式与动画**:
    - **样式优化**: 将被屏蔽引用的占位符从灰色背景盒子改为更简洁的文本样式，并将“展开/折叠”按钮更新为与设置面板统一的圆角矩形按钮。
    - **增加动画**: 为引用的展开和折叠过程增加了平滑的 `max-height` 过渡动画，提升了视觉效果和用户体验。
    - **动画修复**: 解决了动画过程中因高度计算不精确导致的显示不完整和布局偏移问题，确保动画的流畅和稳定。
- **优化引用屏蔽体验**:
    - **即时生效**: 修复了屏蔽用户后，其引用不会立即隐藏，需要手动刷新页面的问题。
    - **占位符替换**: 被屏蔽用户的引用不再是直接消失，而是被一个更友好的占位符替换，提示“一条来自已屏蔽用户的引用已被隐藏。”。
    - **临时查看**: 占位符提供“点击展开/折叠”功能，允许临时查看被屏蔽的引用内容。
    - **样式优化**: 优化了占位符及其按钮的样式，使其在视觉上更贴合论坛和脚本的整体风格，并调整了边距以避免占满整个内容宽度。

---

## [v4.0.2] - 2025-08-05

### 🐛 问题修复
- **修复评分帖子隐藏错误**: 解决了屏蔽用户后，可能会错误地将该用户评分过的帖子整体隐藏的问题。新的实现能更精确地定位并只隐藏发帖者为被屏蔽用户的帖子。
- **修复评分状态刷新**: 修复了取消屏蔽用户后，其评分记录不会立刻重新显示的问题。现在，无论是屏蔽还是取消屏蔽，相关评分的可见性都会即时更新。

### 🐛 问题修复
- **修复用户屏蔽按钮显示异常**: 重构了在用户头像上添加屏蔽按钮的逻辑，通过等待图片完全加载后才计算按钮位置和大小，彻底解决了因网络延迟或图片缓存问题导致的悬浮按钮错位、尺寸不正确或不显示的 BUG。

### ⚡️ 性能优化
- **优化页面变化监测性能**: 将 `MutationObserver` 的监听范围从整个页面 (`body`) 精准地缩小到内容区域 (`#ct`)，显著减少了不必要的脚本重复运行，降低了性能开销，提升了页面流畅度。

---

## [v4.0.0] - 2025-08-02
### 维护

-   **清理项目文件:** 删除了一个不再需要的截图文件 (`longshot20250802025336.png`)，以保持项目仓库的整洁。

### 优化

-   **用户标记浮窗 (User Tagging Popover):**
    -   **UI/UX 大修:** 完全重新设计了用户标记浮窗，使其具有更现代化、更美观的界面。
        -   **页脚信息:** 浮窗现在会显示用户的头像、用户名和 UID，信息更一目了然。
        -   **动态布局:** 浮窗宽度会根据内容（如用户名长度）动态调整，防止文本溢出。
        -   **统一按钮风格:** 更新了浮窗内的所有按钮（添加、编辑、删除、保存、取消），使其默认显示为灰色，并在鼠标悬停时分别变为蓝色（常规操作）或红色（删除操作），与脚本的整体风格保持一致。
    -   **功能改进:**
        -   **输入法兼容性:** 修复了在使用输入法（IME）输入时，浮窗会意外关闭的问题。

### 🎨 优化与重构

*   **UI 微调与版本更新**：
    *   优化了用户标签浮窗中操作按钮的 padding、字体大小和圆角，使其视觉上更精致、协调。
    *   将设置面板内列表项的背景色恢复为淡灰色 (`#f9fafb`)，以修正之前版本中过于刺眼的纯白背景，确保了整体 UI 风格的统一性和舒适度。
    *   更新脚本版本号至 `3.2.2`。

### 🎨 优化与重构

*   **优化用户标签浮窗样式 (v4)**：
    *   **全新视觉设计**：重新设计了用户标签浮窗，采用现代化的半透明玻璃效果 (backdrop-filter)，并优化了边框、阴影和配色，使其更具质感和美观度。
    *   **增强交互体验**：为浮窗内的按钮（如编辑、删除）添加了清晰的 SVG 图标，提升了可识别性。同时，改善了按钮的交互动画和高亮效果，使操作反馈更直观。
    *   **改善布局与内容**：调整了浮窗内部的布局、间距和字体样式，提升了信息的可读性。在没有标签时，会显示更友好的提示信息。

### 🎨 优化与重构

*   **优化悬浮窗交互**：通过增加延迟显示和优化隐藏逻辑，改善了鼠标在用户头像上快速划过时的体验，避免了不必要的浮窗闪烁，使其交互更加稳定和流畅。

### ✨ 新增与增强

*   **初步增加用户标记功能**：当鼠标悬停在用户头像上时，会显示一个悬浮窗，为后续的标记、编辑和删除功能打下基础。

### 🎨 优化与重构

*   **重构悬浮窗交互**：采用事件委托和智能延迟机制重写了悬浮窗的显示/隐藏逻辑，彻底解决了因鼠标快速移动导致的闪烁和异常消失问题，交互体验更稳定、流畅。
*   **优化悬浮窗UI**：重新设计了用户标记浮窗的UI，使其在视觉风格上与脚本整体保持和谐统一，并提升了布局的清晰度和美观度。

### 🐛 问题修复

*   **修复UI遮挡问题**：通过将悬浮窗挂载到 `body` 而非表格单元格，从根本上解决了其被帖子内容区域遮挡的问题。
*   **修复功能冲突**：清除了所有导致新旧功能冲突的CSS和JS代码，确保了“屏蔽用户”等原有功能的UI和交互恢复正常。

### 🎨 优化与重构

*   **优化设置项交互**:
    *   将设置面板中的所有复选框（Checkbox）替换为更现代、更直观的拨动开关（Toggle Switch），提升了视觉效果和操作体验。
    *   改进了“标题关键字屏蔽”功能的工作流，将自动实时保存改为手动点击“保存规则”按钮确认，避免了误操作和不必要的性能开销，并增加了操作成功提示。

### 🎨 优化与重构

* **统一UI颜色**: 脚本中所有功能性红色（如删除、恢复默认、错误提示等）统一为 `#ef4444`，以增强视觉一致性。
* **优化导航栏编辑器**:
    * 修复了拖拽排序时条目变灰且排序不稳定的问题，提升了拖拽体验。
    * 移除了保存设置时的成功提示，使交互流程更简洁。
* **更新图标**: 将编辑器中的“删除”操作从文字图标 '✖' 升级为更现代、更直观的SVG垃圾桶图标，并优化了其高亮交互效果。

### ✨ 新增与增强

* **新增标题关键字屏蔽**: 新增通过关键字或正则表达式屏蔽帖子的功能，并包含独立的规则编辑器。
* **新增用户评分屏蔽**: 现在屏蔽一个用户后，其在帖子下的所有评分记录（战斗力、理由等）也会被自动隐藏。

### 🎨 优化与重构

* **重构关键字屏蔽编辑器**:
    * 移除了“保存规则”按钮，改为自动实时保存机制，并为输入框增加了400ms防抖以优化性能。
    * 优化了工作流：新增的规则默认不启用，并去除了频繁的保存提示。
* **设置面板UI重构**:
    * 将“帖子屏蔽”页的列表重构为可平滑折叠的区域，优化了空间利用。
    * 增强了“界面定制”中的导航链接编辑器，提供了更清晰的布局和拖拽手柄。
    * 将设置面板的关闭按钮替换为更现代的SVG图标。
* **核心与数据**:
    * “设置同步”功能现已完全支持新的关键字屏蔽规则。
    * 实现了对旧版本关键字数据的自动迁移，确保无缝升级。

### 🐛 问题修复

* 修复了从搜索结果页等特定链接 (`mod=viewthread`) 进入帖子后，用户屏蔽功能不生效的问题。
* 修复了关键字编辑器在旧版手动保存逻辑下，会导致UI组件无响应和输入框重复出现的严重BUG。

---

## [v3.0.1] - 2025-07-28

### 🐛 问题修复

*   修复了从搜索结果页打开帖子时，用户屏蔽功能不生效的问题。

---

## [v3.0] - 2025-07-27

### ✨ 新增与增强

*   **新增“跳转至上次阅读位置”功能 (v3.0)**：
    *   **自动记录进度**：在浏览帖子时，脚本会自动在后台记录您看到的最后一个回复的位置。
    *   **快速跳转链接**：在帖子列表页面，对于有阅读记录的帖子，标题旁边会显示一个 `[跳转]` 链接，点击即可直接跳到上次中断的地方，无缝衔接您的阅读体验。
*   **联动屏蔽功能 (v2.8)**：现在当您屏蔽一个用户时，可以选择同时屏蔽该用户发布的所有主题帖。
*   **全量设置同步 (v2.8)**：同步功能得到全面增强，可以一键导出/导入所有配置，包括屏蔽列表、导航栏和各项开关的状态。

### 🎨 优化与重构

*   **设置面板重构 (v2.8)**：设置面板重构为四个独立的标签页，功能划分更清晰。
*   **代码结构优化**：对多个功能模块进行了代码优化和重构，提升了脚本的稳定性和可维护性。

---

## [v2.7] - 2025-07-26

### 🐛 问题修复

* 修复了自动签到功能在多账号切换时状态不互通的问题。

---

## [v2.6] - 2025-07-26

### 🐛 问题修复

* 修复了自动签到功能被移除的问题。

---

## [v2.5] - 2025-07-26

### 🎨 优化与重构

* **帖子屏蔽按钮UI**：重做并升级了帖子屏蔽按钮的UI和交互，采用更现代化的悬浮标签样式，并增加了更平滑的动画效果，提升了操作直观性和视觉体验。

---

## [v2.4] - 2025-07-26

### ✨ 新增与增强

* **新增“界面定制”功能**：
    * **自定义导航栏**：允许通过拖拽方式自由管理导航链接。
    * **调整界面元素**：可修改论坛Logo链接及隐藏屏蔽用户发言的提示条。

### 🎨 优化与重构

* **设置管理**：重构了设置的保存与加载逻辑，使所有界面定制选项均可即时生效。
* **代码结构**：对UI创建和事件处理部分的代码进行了模块化重构。

---

## [v2.3] - 2025-07-26

### 🐛 问题修复

* **样式兼容性**：调整了屏蔽按钮的CSS，解决了与自定义主题（如 “S1 NUX”）的样式冲突问题。

---

## [v2.2] - 2025-07-26

### 🎨 优化与重构

* **确认弹窗**：重写了屏蔽用户的确认弹窗，替换系统默认弹窗，统一了UI风格并增加了动画效果，提升了用户体验。

---

## [v2.1] - 2025-07-26

### ✨ 新增与增强

* 在“屏蔽管理”面板的页脚增加了版本号和发布日期显示。

### 🎨 优化与重构

* 移除了脚本文件内嵌的更新日志等注释，使代码更简洁。

---

## [v2.0] - 2025-07-26

### ✨ 新增与增强

* **新增用户屏蔽核心功能**：支持鼠标悬停于用户头像上进行屏蔽。

### 🎨 优化与重构

* **屏蔽管理界面**：重新设计管理弹窗，使用选项卡区分“帖子屏蔽”与“用户屏蔽”。
* **数据同步**：更新了导入/导出功能，使其能同时处理帖子和用户的屏蔽数据。
* **UI/UX**：改进了屏蔽按钮的交互动画和视觉样式。

---

## [v1.0 - v1.9]

* **v1.9**：修复了自动签到功能在多账号切换时状态不互通的问题。
* **v1.8**：新增自动签到功能；并修复了部分情况下帖子列表第一个帖子不显示屏蔽按钮的bug。
* **v1.7**：整合了 `@match` 指令，提高匹配效率。
* **v1.6**：新增设置项允许用户选择屏蔽按钮显示位置；并优化了设置项体验，关闭窗口后自动刷新页面。
* **v1.5**：修复了帖子详情页面不显示“屏蔽管理”按钮的bug。
* **v1.4**：优化了屏蔽按钮样式，增加字体粗细。
* **v1.3**：增加了屏蔽按钮右侧间距，解决与“New”标签重叠问题。
* **v1.2**：添加了置顶帖屏蔽功能。
* **v1.1**：添加了多设备同步功能并优化了UI。
* **v1.0**：初始版本发布，实现了基本的帖子屏蔽功能和管理界面。